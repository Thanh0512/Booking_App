{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Admin\\\\Desktop\\\\Assignment2\\\\client\\\\src\\\\context\\\\AuthContext.jsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { createContext, useContext, useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport const useAuth = () => {\n  _s();\n\n  return useContext(AuthContext);\n};\n\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nexport const AuthProvider = _ref => {\n  _s2();\n\n  let {\n    children\n  } = _ref;\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true); // Cấu hình axios toàn cục\n\n  axios.defaults.baseURL = 'http://localhost:5000';\n  axios.defaults.headers.post['Content-Type'] = 'application/json'; // Kiểm tra token khi load trang\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n\n    if (token) {\n      // Gán token cho mọi request\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`; // Gọi API để lấy thông tin user (tùy chọn)\n      // Có thể gọi /api/users/me nếu backend có\n      // Ở đây giả lập user từ token\n\n      try {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        setUser({\n          id: payload.id,\n          email: payload.email || payload.username,\n          isAdmin: payload.isAdmin || false\n        });\n      } catch (err) {\n        localStorage.removeItem('token');\n      }\n    }\n\n    setLoading(false);\n  }, []); // === ĐĂNG KÝ ===\n\n  const register = async formData => {\n    try {\n      const res = await axios.post('/api/users/register', formData);\n\n      if (res.data.success) {\n        alert(res.data.message || 'Đăng ký thành công! Vui lòng đăng nhập.');\n        return res.data;\n      }\n    } catch (err) {\n      throw err;\n    }\n  }; // === ĐĂNG NHẬP ===\n\n\n  const login = async (username, password) => {\n    try {\n      const res = await axios.post('/api/users/login', {\n        username,\n        password\n      });\n\n      if (res.data.success) {\n        const {\n          token,\n          user: userData\n        } = res.data; // Lưu token\n\n        localStorage.setItem('token', token);\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token}`; // Lưu user\n\n        setUser({\n          id: userData.id,\n          email: userData.email,\n          username: userData.username,\n          fullName: userData.fullName\n        });\n        return res.data;\n      }\n    } catch (err) {\n      throw err;\n    }\n  }; // === ĐĂNG XUẤT ===\n\n\n  const logout = () => {\n    localStorage.removeItem('token');\n    delete axios.defaults.headers.common['Authorization'];\n    setUser(null);\n  };\n\n  const value = {\n    user,\n    login,\n    register,\n    logout,\n    loading\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: !loading && children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(AuthProvider, \"NiO5z6JIqzX62LS5UWDgIqbZYyY=\");\n\n_c = AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["C:/Users/Admin/Desktop/Assignment2/client/src/context/AuthContext.jsx"],"names":["createContext","useContext","useState","useEffect","axios","AuthContext","useAuth","AuthProvider","children","user","setUser","loading","setLoading","defaults","baseURL","headers","post","token","localStorage","getItem","common","payload","JSON","parse","atob","split","id","email","username","isAdmin","err","removeItem","register","formData","res","data","success","alert","message","login","password","userData","setItem","fullName","logout","value"],"mappings":"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","sourcesContent":["import { createContext, useContext, useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Cấu hình axios toàn cục\r\n  axios.defaults.baseURL = 'http://localhost:5000';\r\n  axios.defaults.headers.post['Content-Type'] = 'application/json';\r\n\r\n  // Kiểm tra token khi load trang\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n      // Gán token cho mọi request\r\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      \r\n      // Gọi API để lấy thông tin user (tùy chọn)\r\n      // Có thể gọi /api/users/me nếu backend có\r\n      // Ở đây giả lập user từ token\r\n      try {\r\n        const payload = JSON.parse(atob(token.split('.')[1]));\r\n        setUser({\r\n          id: payload.id,\r\n          email: payload.email || payload.username,\r\n          isAdmin: payload.isAdmin || false\r\n        });\r\n      } catch (err) {\r\n        localStorage.removeItem('token');\r\n      }\r\n    }\r\n    setLoading(false);\r\n  }, []);\r\n\r\n  // === ĐĂNG KÝ ===\r\n  const register = async (formData) => {\r\n    try {\r\n      const res = await axios.post('/api/users/register', formData);\r\n      if (res.data.success) {\r\n        alert(res.data.message || 'Đăng ký thành công! Vui lòng đăng nhập.');\r\n        return res.data;\r\n      }\r\n    } catch (err) {\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  // === ĐĂNG NHẬP ===\r\n  const login = async (username, password) => {\r\n    try {\r\n      const res = await axios.post('/api/users/login', { username, password });\r\n      if (res.data.success) {\r\n        const { token, user: userData } = res.data;\r\n        \r\n        // Lưu token\r\n        localStorage.setItem('token', token);\r\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n        \r\n        // Lưu user\r\n        setUser({\r\n          id: userData.id,\r\n          email: userData.email,\r\n          username: userData.username,\r\n          fullName: userData.fullName\r\n        });\r\n\r\n        return res.data;\r\n      }\r\n    } catch (err) {\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  // === ĐĂNG XUẤT ===\r\n  const logout = () => {\r\n    localStorage.removeItem('token');\r\n    delete axios.defaults.headers.common['Authorization'];\r\n    setUser(null);\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    login,\r\n    register,\r\n    logout,\r\n    loading\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {!loading && children}\r\n    </AuthContext.Provider>\r\n  );\r\n};"]},"metadata":{},"sourceType":"module"}